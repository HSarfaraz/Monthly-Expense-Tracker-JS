<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home Expenses Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white shadow-lg rounded-lg p-6 w-full max-w-5xl">
    <h1 class="text-2xl font-bold text-center text-blue-600 mb-4">🏠 Home Expenses Tracker (1 Year)</h1>
    
    <!-- Salary -->
    <div class="mb-4 text-lg font-bold text-green-700 flex items-center">
      💼 Salary: ₹ 
      <input id="salaryInput" type="number" value="165000" disabled class="border ml-2 px-3 py-1 rounded w-40">
      <button id="salaryToggle" class="ml-2 text-blue-600"><i class="fa fa-lock"></i></button>
    </div>

    <!-- Month Selector -->
    <div class="flex justify-between mb-4">
      <label for="month" class="font-semibold"><i class="fa-solid fa-calendar"></i> Select Month:</label>
      <select id="month" class="border border-gray-300 rounded px-3 py-2 w-1/3">
        <script>
          const months = [
            "January","February","March","April","May","June",
            "July","August","September","October","November","December"
          ];
          document.write(months.map((m,i)=>`<option value="${i}" ${m==="August"?"selected":""}>${m}</option>`).join(''));
        </script>
      </select>
    </div>

    <!-- Expenses Sections -->
    <div id="expenseSections" class="space-y-6"></div>

    <!-- Add Expense Button -->
    <button id="addExpense" class="mt-2 bg-yellow-500 text-white px-3 py-1 rounded"><i class="fa fa-plus"></i> Add Expense</button>

    <!-- Actions -->
    <div class="flex justify-between mt-4">
      <button id="calculate" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Calculate Total</button>
      <button id="save" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Save Month</button>
    </div>

    <!-- Totals -->
    <div class="mt-4 text-lg font-semibold text-center">
      Total: ₹<span id="total">0</span> | 💰 Saving: ₹<span id="saving">0</span>
    </div>

    <!-- Yearly Summary -->
   
    
    
    <div class="flex justify-between my-4">
       <h2 class="text-xl font-bold mt-6 mb-2 text-gray-700">📅 Monthwise Expenses Summary </h2> 
      <button onclick="resetSummary()" 
        class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded mt-3">
        Reset Summary
      </button>
      <button onclick="downloadYearlyPDF()" 
        class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded mt-3">
        Download Yearly PDF
      </button>
    </div>
    <ul id="summary" class="bg-gray-50 border rounded p-3 h-40 overflow-y-auto"></ul>
  </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
async function downloadPDF(month, expenses, saving) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Title
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  doc.text(`Month: ${month}`, 14, 15);

  // Summary (use "/-" text instead of ₹)
  doc.setFont("helvetica", "normal");
  doc.setFontSize(12);
  doc.text(`Total Expenses: ${expenses} /-`, 14, 25);
  doc.text(`Savings: ${saving} /-`, 14, 32);

  // Prepare Clean Expense Table Data
  const tableData = [];
  document.querySelectorAll(".expense-label").forEach((label, index) => {
    const value = document.querySelectorAll(".expense")[index].value || 0;
    const cleanLabel = label.value.replace(/[^a-zA-Z0-9\s:]/g, '').trim(); // Remove emojis
    const cleanValue = value.toString().replace(/[^\d]/g, ''); // Strict digits only
    tableData.push([cleanLabel, `${cleanValue} /-`]); // ✅ Use "/-"
  });

  // Expense Breakdown Table
  doc.autoTable({
    head: [['Expense Item', 'Amount (/-)']],  // ✅ Update header text
    body: tableData,
    startY: 42,
    theme: 'striped',
    styles: { font: "helvetica", fontSize: 10, cellPadding: 3 },
    headStyles: { fillColor: [41, 128, 185], textColor: 255, fontSize: 11, fontStyle: "bold" },
    bodyStyles: { textColor: [40, 40, 40] },
    columnStyles: {
      0: { cellWidth: 110, halign: 'left' },
      1: { cellWidth: 60, halign: 'left' } // Amount aligned left
    },
    margin: { left: 14, right: 14 }
  });

  // Footer
  const pageHeight = doc.internal.pageSize.height;
  doc.setFontSize(9);
  doc.setTextColor(150);
  doc.text("Generated by Home Expenses Tracker", 14, pageHeight - 10);

  // Save PDF
  doc.save(`${month}_Expenses.pdf`);
}

async function downloadYearlyPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  Object.entries(yearlyData).forEach(([month, expenses], index) => {
    const saving = salary - expenses;

    // Title
    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text(`Month: ${month}`, 14, 15);

    // Summary (use "/-")
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
    doc.text(`Total Expenses: ${expenses} /-`, 14, 25);
    doc.text(`Savings: ${saving} /-`, 14, 32);

    // Prepare Clean Expense Data
    const tableData = [];
    document.querySelectorAll(".expense-label").forEach((label, idx) => {
      const value = document.querySelectorAll(".expense")[idx].value || 0;
      const cleanLabel = label.value.replace(/[^a-zA-Z0-9\s:]/g, '').trim();
      const cleanValue = value.toString().replace(/[^\d]/g, '');
      tableData.push([cleanLabel, `${cleanValue} /-`]);
    });

    // Expense Table
    doc.autoTable({
      head: [['Expense Item', 'Amount (/-)']],
      body: tableData,
      startY: 42,
      theme: 'striped',
      styles: { font: "helvetica", fontSize: 10, cellPadding: 3 },
      headStyles: { fillColor: [41, 128, 185], textColor: 255, fontSize: 11 },
      bodyStyles: { textColor: [40, 40, 40] },
      columnStyles: {
        0: { cellWidth: 110, halign: 'left' },
        1: { cellWidth: 60, halign: 'left' }
      },
      margin: { left: 14, right: 14 }
    });

    // Footer
    const pageHeight = doc.internal.pageSize.height;
    doc.setFontSize(9);
    doc.setTextColor(150);
    doc.text("Generated by Home Expenses Tracker", 14, pageHeight - 10);

    // Add new page except last
    if (index < Object.keys(yearlyData).length - 1) {
      doc.addPage();
    }
  });

  // Save PDF
  doc.save("Yearly_Expenses.pdf");
}
function resetSummary() {
  if (confirm("Are you sure you want to reset the summary? This will clear all saved data.")) {
    yearlyData = {}; // Clear in-memory data
    localStorage.removeItem("yearlyExpenses"); // Clear from local storage
    displaySummary(); // Refresh summary table
    alert("Summary has been reset successfully!");
  }
}

</script>


  <script>
    let salary = 165000;
    const salaryInput = document.getElementById("salaryInput");
    const salaryToggle = document.getElementById("salaryToggle");
    const expenseSections = document.getElementById("expenseSections");
    const calculateBtn = document.getElementById("calculate");
    const saveBtn = document.getElementById("save");
    const addExpenseBtn = document.getElementById("addExpense");
    const totalDisplay = document.getElementById("total");
    const savingDisplay = document.getElementById("saving");
    const summaryList = document.getElementById("summary");
    const monthSelect = document.getElementById("month");

    let yearlyData = JSON.parse(localStorage.getItem("yearlyExpenses")) || {};

    const expenseData = [
      {
        title: "🧾 Default Deduction",
        locked: true,
        items: [
          { label: "🏠 Home Loan EMI", value: 48000 },
          { label: "🔧 Maintenance", value: 2709 },
          { label: "💡 Light Bill", value: 1500 },
          { label: "🥦 Veg", value: 2000 },
          { label: "🍗 Non-Veg", value: 1500 },
          { label: "🥛 Milk", value: 1500 },
          { label: "🧹 Maid", value: 3000 },
          { label: "🔥 Gas", value: 1000 },
          { label: "🍎 Fruits", value: 2000 },
          { label: "🛒 Grocery", value: 3000 },
          { label: "⛽ Bike's Petrol", value: 3000 },
          { label: "📚 Maryam's Arabi Fee", value: 1000 },
          { label: "🤖 ChatGPT", value: 2000 },
          { label: "🏦 Hina's HDFC Mini Balance", value: 10000 },
          { label: "🥐 Outside Breakfast", value: 1000 },
          { label: "🍽️ Outside Lunch / Dinner", value: 1000 },
          { label: "❤️ Hina's Health", value: 500 },
          { label: "🎓 Yusuf's School fee", value: 3000 },
          { label: "🍰 Bakery", value: 500 }
        ]
      },
      {
        title: "🏡 Flat Maintenance",
        locked: false,
        items: [
          { label: "🚰 Water Tanker", value: 3500 }
        ]
      },
      {
        title: "💳 BC1",
        locked: false,
        items: [
          { label: "👨 Sir's BC1", value: 30000 },
          { label: "👩 Arefa Baji BC2", value: 20000 }
        ]
      },
      {
        title: "🩺 Family Health",
        locked: false,
        items: [
          { label: "💙 Sarfaraz's Health", value: 500 },
          { label: "💖 Maryam's Health", value: 0 },
          { label: "💛 Yusuf's Health", value: 0 }
        ]
      },
      {
        title: "📦 Extra",
        locked: false,
        items: [
          { label: "🛵 Bike's Maintenance", value: 3000 },
          { label: "💰 Personal Loan EMI", value: 1300 },
          { label: "📚 Sarfaraz's Learning", value: 500 },
          { label: "🛍️ Shopping", value: 500 },
          { label: "💼 Extra Buffer", value: 10000 }
        ]
      }
    ];

    salaryToggle.addEventListener("click", () => {
      salaryInput.disabled = !salaryInput.disabled;
      salaryToggle.querySelector("i").className = salaryInput.disabled ? "fa fa-lock" : "fa fa-lock-open";
      salary = Number(salaryInput.value) || 0;
      calculateTotal();
    });

    salaryInput.addEventListener("input", () => {
      salary = Number(salaryInput.value) || 0;
      calculateTotal();
    });

    function renderSections() {
      expenseSections.innerHTML = "";
      expenseData.forEach(section => {
        const sectionDiv = document.createElement("div");

        // Editable Heading
        sectionDiv.innerHTML = `
          <div class="flex items-center mb-2">
            <input type="text" value="${section.title}" class="section-title font-bold text-blue-600 underline bg-transparent border-none w-2/3">
          </div>
        `;

        const grid = document.createElement("div");
        grid.className = "grid grid-cols-2 gap-4";
        section.items.forEach(exp => grid.appendChild(createExpenseRow(exp.label, exp.value, section.locked)));
        sectionDiv.appendChild(grid);
        expenseSections.appendChild(sectionDiv);
      });
    }

    function createExpenseRow(label, value, locked) {
      const row = document.createElement("div");
      row.className = `flex items-center space-x-2 p-2 ${locked ? 'bg-gray-50' : 'bg-white'} border rounded`;

      row.innerHTML = `
        <input type="text" value="${label}" class="expense-label w-1/2 font-semibold bg-transparent border-b border-dashed focus:outline-none">
        <input type="number" value="${value}" ${locked ? 'disabled' : ''} class="expense border w-1/3 px-3 py-1 rounded">
        <button class="toggle-btn text-blue-600"><i class="fa ${locked ? 'fa-lock' : 'fa-lock-open'}"></i></button>
        <button class="delete-btn text-red-600"><i class="fa fa-trash"></i></button>
      `;

      const toggleBtn = row.querySelector(".toggle-btn");
      const deleteBtn = row.querySelector(".delete-btn");

      toggleBtn.addEventListener("click", () => {
        const input = row.querySelector(".expense");
        input.disabled = !input.disabled;
        toggleBtn.querySelector("i").className = input.disabled ? "fa fa-lock text-gray-600" : "fa fa-lock-open text-blue-600";
      });

      deleteBtn.addEventListener("click", () => row.remove());

      return row;
    }

    function calculateTotal() {
      const expenses = document.querySelectorAll(".expense");
      let total = 0;
      expenses.forEach(e => total += Number(e.value) || 0);
      totalDisplay.textContent = total.toLocaleString();
      savingDisplay.textContent = (salary - total).toLocaleString();
      return total;
    }

    function saveMonth() {
      const monthName = months[monthSelect.value];
      const total = calculateTotal();
      yearlyData[monthName] = total;
      localStorage.setItem("yearlyExpenses", JSON.stringify(yearlyData));
      displaySummary();
    }

   
	
	function displaySummary() {
				  summaryList.innerHTML = `
					<table class="w-full text-left border-collapse">
					  <thead>
						<tr class="bg-gray-100 border-b">
						  <th class="p-2">📅 Month</th>
						  <th class="p-2">💸 Expenses (₹)</th>
						  <th class="p-2">💰 Savings (₹)</th>
						  <th class="p-2">⬇️ Download</th>
						</tr>
					  </thead>
					  <tbody id="summaryBody"></tbody>
					</table>
				  `;

				  const summaryBody = document.getElementById("summaryBody");
				  summaryBody.innerHTML = "";

				  for (const [month, total] of Object.entries(yearlyData)) {
					const saving = salary - total;
					const row = document.createElement("tr");
					row.className = "border-b hover:bg-gray-50";
					row.innerHTML = `
					  <td class="p-2">${month}</td>
					  <td class="p-2 text-blue-600 font-bold">₹${total.toLocaleString()}</td>
					  <td class="p-2 text-green-600 font-bold">₹${saving.toLocaleString()}</td>
					  <td class="p-2">
						<button onclick="downloadPDF('${month}', ${total}, ${saving})" class="bg-red-500 text-white px-3 py-1 rounded text-sm">
						  PDF
						</button>
					  </td>
					`;
					summaryBody.appendChild(row);
				  }
				}

	
	addExpenseBtn.addEventListener("click", () => {
	  // Always add to the last section (e.g., "Extra")
	  const lastSection = expenseSections.lastChild.querySelector("div.grid");
	  const newRow = createExpenseRow("📝 New Expense", 0, false);
	  lastSection.appendChild(newRow); // ✅ Always appended at the bottom
	});

    calculateBtn.addEventListener("click", calculateTotal);
    saveBtn.addEventListener("click", saveMonth);

    renderSections();
    calculateTotal();
    displaySummary();
  </script>
</body>
</html>
